Hiscore=Backbone.Model.extend({defaults:{},initialize:function(){},open:function(c){var b=this;var a=new Clay.Leaderboard({id:1213,limit:50});b.set("lb",a)},save:function(e,b,f){var d=this;var a=d.get("lb");if(a===undefined){if(f){f(null);return}}var c={name:e,score:b,};a.post(c,function(g){if(f){console.log(g);if(g.success){f(true)}else{f(null)}}})},getAllScores:function(c){var b=this;var a=b.get("lb");if(a===undefined){if(c){c(null);return}}a.fetch({},function(f){console.log(f);if(f&&f.length>0){if(c){var d=[];for(var e=0;e<f.length;e++){var g=f[e];d.push({name:g.name,score:g.score})}c(d)}}else{if(_Globals.conf.get("debug")){console.log("Load scores failed!");console.log(response)}if(c){c(null)}}})},});Crafty.bind("ShowSaveHiscore",function(a){$("#dialog-save-score").dialog({resizable:false,width:400,height:300,modal:false,title:"Save Hiscore",zIndex:20,buttons:{Yes:function(){while(true){var c=prompt("Please enter your rabbit name (Maximum 10 characters)","");if(c!=null&&c.trim()!=""){var b=_Globals.hiscore;c=c.replace(/<(?:.|\n)*?>/gm,"");c=c.substr(0,10);b.save(c,a,function(d){if(d){Crafty.trigger("ShowHiscore",{text:undefined,refresh:true})}else{Crafty.trigger("ShowHiscore",{text:"Failed saving your score! Sorry :(",refresh:true})}});break}else{if(c===null){window.location.reload();break}}}$(this).dialog("close")},No:function(){$(this).dialog("close");Crafty.trigger("ShowHiscore",{text:undefined,refresh:true})}},})});Crafty.bind("ShowHiscore",function(a){$("#dialog-score").dialog({resizable:false,width:400,minHeight:520,height:520,modal:true,position:"top",title:"Top 50 Scores",open:function(){$("#dialog-score").css({height:"520px"});if(!a.text){$("#dialog-score").html("<p>Please wait while loading scores ...</p>");var b=_Globals.hiscore;var c="<div>";c+='<span class="name u">';c+="Name";c+="</span>";c+='<span class="score u">';c+="Carrots";c+="</span>";c+="</div>";b.getAllScores(function(f,e){if(f===null){c+="<div>";c+='<span class="name">';c+="Failed loading scores!";c+="</span>";c+='<span class="score">';c+="</span>";c+="</div>"}else{var d=0;_.each(f,function(g){if(++d>50){return}c+="<div>";c+='<span class="name">';c+=d+". ";c+=g.name;c+="</span>";c+='<span class="score">';c+=g.score;c+="</span>";c+="</div>"})}$("#dialog-score").html(c)});return}else{$("#dialog-score").html(a.text)}},buttons:{"Refresh Scores":function(){$(this).dialog("close");Crafty.trigger("ShowHiscore",a)},"Let me out!":function(){if(a.refresh){window.location.reload()}$(this).dialog("close")}},close:function(b,c){}})});