Hiscore=Backbone.Model.extend({defaults:{storageName:"RGGame_dc32000e-afd6-481e-8807-4dd838f2d922",version:1,storageTable:"hiscore",board:"highscores",},initialize:function(){},open:function(a){Playtomic.Log.View("951587","b45d8d7a0e6d460b","b6fefae7617943f3937c883763706d",document.location)},save:function(c,d,e){var b=this;var a={};a.Name=c;a.Points=d;Playtomic.Leaderboards.Save(a,b.get("board"),function(f){if(e){console.log(f);if(f.Success){e(true)}else{e(null)}}},{allowduplicates:true})},getAllScores:function(b){var a=this;Playtomic.Leaderboards.List(a.get("board"),function(g,h,d){if(d.Success){if(b){var c=[];for(var e=0;e<g.length;e++){var f=g[e];c.push({name:f.Name,score:f.Points})}b(c)}}else{if(_Globals.conf.get("debug")){console.log("Save score failed!");console.log(d)}if(b){b(null)}}},{perpage:50})},});Crafty.bind("ShowSaveHiscore",function(a){$("#dialog-save-score").dialog({resizable:false,width:400,height:300,modal:false,title:"Save Hiscore",zIndex:20,buttons:{Yes:function(){while(true){var c=prompt("Please enter your rabbit name (Maximum 10 characters)","");if(c!=null&&c.trim()!=""){var b=new Hiscore();c=c.replace(/<(?:.|\n)*?>/gm,"");c=c.substr(0,10);b.save(c,a,function(d){if(d){Crafty.trigger("ShowHiscore",{text:undefined,refresh:true})}else{Crafty.trigger("ShowHiscore",{text:"Failed saving your score! Sorry :(",refresh:true})}});break}else{if(c===null){window.location.reload();break}}}$(this).dialog("close")},No:function(){$(this).dialog("close");Crafty.trigger("ShowHiscore",{text:undefined,refresh:true})}},})});Crafty.bind("ShowHiscore",function(a){$("#dialog-score").dialog({resizable:false,width:400,minHeight:520,height:520,modal:true,position:"top",title:"Top 50 Scores",open:function(){$("#dialog-score").css({height:"520px"});if(!a.text){$("#dialog-score").html("<p>Please wait while loading scores ...</p>");var b=new Hiscore();var c="<div>";c+='<span class="name u">';c+="Name";c+="</span>";c+='<span class="score u">';c+="Carrots";c+="</span>";c+="</div>";b.getAllScores(function(f,e){var d=0;_.each(f,function(g){if(++d>50){return}c+="<div>";c+='<span class="name">';c+=d+". ";c+=g.name;c+="</span>";c+='<span class="score">';c+=g.score;c+="</span>";c+="</div>"});$("#dialog-score").html(c)});return}else{$("#dialog-score").html(a.text)}},buttons:{"Refresh Scores":function(){$(this).dialog("close");Crafty.trigger("ShowHiscore",a)},"Let me out!":function(){if(a.refresh){window.location.reload()}$(this).dialog("close")}},close:function(b,c){}})});