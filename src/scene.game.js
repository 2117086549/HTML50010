Crafty.scene("main",function(){var d=new Tilemap();var g=new Player({tileMap:d});$("#left-frame").show();$("#right-frame").show();$("#bottom-frame").show();$("#stats").show();$("#in-menu").show();if(_Globals.conf.get("debug")||_Globals.conf.get("showfps")){Crafty.e("2D, "+_Globals.conf.get("renderType")+", FPS").attr({maxValues:10}).bind("MessureFPS",function(j){$("#fps").text("FPS: "+j.value)});$("#fps").show()}var i=false;$("#toggle-sfx").click(function(){Crafty.audio.toggleMute();i=!i;if(i){$("#toggle-sfx").css("background-image","url('art/sound_off-05.png')")}else{$("#toggle-sfx").css("background-image","url('art/sound_on-05.png')")}});var h=false;$("#toggle-music").click(function(){h=!h;if(h){Crafty.audio.stop("music");$("#toggle-music").css("background-image","url('art/sound_off.png')")}else{Crafty.audio.play("music",-1,_Globals.conf.get("music_vol"));$("#toggle-music").css("background-image","url('art/sound_on.png')")}});if(_Globals.conf.get("music")){Crafty.audio.play("music",-1,_Globals.conf.get("music_vol"))}Crafty.bind("UpdateStats",function(){$("#carrots").text(g.get("carrotsCount"))});Crafty.bind("ShowMsg",function(j){$("#msgs").stop(true);$("#msgs").css("opacity","1.0");$("#msgs").css("fontSize","26px");$("#msgs").text("");if(j=="carrots"){$("#msgs").text("You have no carrots to eat!")}else{if(j=="clear"){$("#msgs").text("");return}}$("#msgs").fadeTo(800,0)});var a=0;var f=_Globals.conf.get("startEnemiesCount");d.set("maxCarrots",_Globals.conf.get("startCarrotsCount"));var e=0;var c=Date.now()+_Globals.conf.get("gameTimeLimit");var b=Date.now()+_Globals.conf.get("gameTurnPeriod");Crafty.bind("EnterFrame",function(o){var l=Date.now();if(c<l){Crafty.stop();Crafty.trigger("ShowSaveHiscore",g.get("carrotsCount"))}else{var n=(c-l)/1000;var m=Math.floor(n/60);var p=n%60;var k=m.toFixed(0);k=k<10?"0"+k:k;var j=p.toFixed(2);j=j<10?"0"+j:j;$("#timer").text(k+":"+j)}var l=Date.now();if(l>b){b=Date.now()+_Globals.conf.get("gameTurnPeriod");if(d.get("maxCarrots")<_Globals.conf.get("maxCarrotsToSpawn")){d.set("maxCarrots",d.get("maxCarrots")+_Globals.conf.get("carrotsPerTurn"))}f+=_Globals.conf.get("enemiesPerTurn");f=f>_Globals.conf.get("maxEnemiesToSpawn")?_Globals.conf.get("maxEnemiesToSpawn"):f;if(_Globals.conf.get("debug")){console.log("Turn passed! New limites carrots: %d, enemies: %d",d.get("maxCarrots"),f)}}if(l>e){d.spawnCarrot();if(a<f){new Enemy({tileMap:d,player:g});a++}e=Date.now()+_Globals.conf.get("gameTickPeriod")}});Crafty.trigger("UpdateStats")});