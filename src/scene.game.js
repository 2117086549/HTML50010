Crafty.scene("main",function(){var e=new Tilemap();var h=new Player({tileMap:e});if(!_Globals.conf.get("mobile")){$("#left-frame").show();$("#right-frame").show();$("#bottom-frame").show()}$(".safari").hide();$("#stats").show();$("#in-menu").show();if(_Globals.conf.get("debug")||_Globals.conf.get("showfps")){Crafty.e("2D, "+_Globals.conf.get("renderType")+", FPS").attr({maxValues:10}).bind("MessureFPS",function(k){$("#fps").text("FPS: "+k.value)});$("#fps").show()}var j=false;$("#toggle-sfx").click(function(){Crafty.audio.toggleMute();j=!j;if(j){$("#toggle-sfx").css("background-image","url('art/sound_off-05.png')")}else{$("#toggle-sfx").css("background-image","url('art/sound_on-05.png')")}});var i=false;$("#toggle-music").click(function(){i=!i;if(i){Crafty.audio.stop("music");$("#toggle-music").css("background-image","url('art/sound_off.png')")}else{Crafty.audio.play("music",-1,_Globals.conf.get("music_vol"));$("#toggle-music").css("background-image","url('art/sound_on.png')")}});if(_Globals.conf.get("music")){Crafty.audio.play("music",-1,_Globals.conf.get("music_vol"))}Crafty.bind("UpdateStats",function(){$("#carrots").text(h.get("carrotsCount"))});Crafty.bind("ShowMsg",function(k){$("#msgs").stop(true);$("#msgs").css("opacity","1.0");$("#msgs").css("fontSize","26px");$("#msgs").text("");if(k=="carrots"){$("#msgs").text("You have no carrots to eat!")}else{if(k=="clear"){$("#msgs").text("");return}}$("#msgs").fadeTo(800,0)});var a=0;var g=_Globals.conf.get("startEnemiesCount");e.set("maxCarrots",_Globals.conf.get("startCarrotsCount"));var f=0;var d=Date.now()+_Globals.conf.get("gameTimeLimit");var b=Date.now()+_Globals.conf.get("gameTurnPeriod");var c=function(p){var m=Date.now();if(d<m){Crafty.unbind("EnterFrame");Crafty.stop();Crafty.trigger("ShowSaveHiscore",h.get("carrotsCount"))}else{var o=(d-m)/1000;var n=Math.floor(o/60);var q=o%60;var l=n.toFixed(0);l=l<10?"0"+l:l;var k=q.toFixed(0);k=k<10?"0"+k:k;$("#timer").text(l+":"+k)}var m=Date.now();if(m>b){b=Date.now()+_Globals.conf.get("gameTurnPeriod");if(e.get("maxCarrots")<_Globals.conf.get("maxCarrotsToSpawn")){e.set("maxCarrots",e.get("maxCarrots")+_Globals.conf.get("carrotsPerTurn"))}g+=_Globals.conf.get("enemiesPerTurn");g=g>_Globals.conf.get("maxEnemiesToSpawn")?_Globals.conf.get("maxEnemiesToSpawn"):g;if(_Globals.conf.get("debug")){console.log("Turn passed! New limites carrots: %d, enemies: %d",e.get("maxCarrots"),g)}}if(m>f){e.spawnCarrot();if(a<g){new Enemy({tileMap:e,player:h});a++}f=Date.now()+_Globals.conf.get("gameTickPeriod")}};Crafty.bind("EnterFrame",c);Crafty.trigger("UpdateStats")});